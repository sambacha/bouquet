{"version":3,"file":"ImportModal.js","sourceRoot":"","sources":["../../ts/components/ImportModal.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Signal, useComputed, useSignal } from \"@preact/signals\"\nimport { utils } from \"ethers\"\nimport { JSX } from \"preact/jsx-runtime\"\nimport { TransactionList } from \"../types/bouquetTypes.js\"\nimport { EthereumAddress } from \"../types/ethereumTypes.js\"\nimport { Bundle, serialize } from \"../types/types.js\"\nimport { Button } from \"./Button.js\"\n\nconst placeholder = `[\n  {\n    \"from\": \"0xb3cd36cfaa07652dbfecca76f438ff8998a4f539\",\n    \"to\": \"0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6\",\n    \"value\": \"0x16345785d8a0000\",\n    \"input\": \"0xd0e30db0\",\n    \"chainId\": \"0x1\",\n    \"gasLimit\": \"0x15f90\"\n  },\n  {\n    \"from\": \"0xb3cd36cfaa07652dbfecca76f438ff8998a4f539\",\n    \"to\": \"0xb4fbf271143f4fbf7b91a5ded31805e42b2208d6\",\n    \"value\": \"0x0\",\n    \"input\": \"0x2e1a7d4d000000000000000000000000000000000000000000000000016345785d8a0000\",\n    \"chainId\": \"0x1\",\n    \"gasLimit\": \"0x15f90\"\n  }\n]`\n\nexport const ImportModal = ({ display, bundle }: { display: Signal<boolean>, bundle: Signal<Bundle | undefined> }) => {\n\tconst jsonInput = useSignal<string>('')\n\n\tconst isValid = useComputed(() => {\n\t\tif (!jsonInput.value) return false\n\t\ttry {\n\t\t\tconst { success } = TransactionList.safeParse(JSON.parse(jsonInput.value))\n\t\t\treturn success\n\t\t} catch {\n\t\t\treturn false\n\t\t}\n\t})\n\n\tfunction importJson() {\n\t\tif (!isValid.peek()) return\n\t\tconst txList = TransactionList.parse(JSON.parse(jsonInput.value))\n\n\t\tlocalStorage.setItem('payload', JSON.stringify(TransactionList.serialize(txList)))\n\n\t\tconst containsFundingTx = txList.length > 1 && txList[0].to === txList[1].from\n\t\tconst uniqueSigners = [...new Set(txList.map((x) => utils.getAddress(serialize(EthereumAddress, x.from))))].filter(\n\t\t\t(_, index) => !(index === 0 && containsFundingTx),\n\t\t)\n\n\t\tconst totalGas = txList.reduce((sum, tx, index) => (index === 0 && containsFundingTx ? 21000n : BigInt(tx.gasLimit.toString()) + sum), 0n)\n\t\t// @TODO: Change this to track minimum amount of ETH needed to deposit\n\t\tconst inputValue = txList.reduce((sum, tx, index) => (index === 0 && containsFundingTx ? 0n : BigInt(tx.value.toString()) + sum), 0n)\n\n\t\tbundle.value = { transactions: txList, containsFundingTx, uniqueSigners, totalGas, inputValue }\n\t\tclose()\n\t}\n\n\tfunction close() {\n\t\tjsonInput.value = ''\n\t\tdisplay.value = false\n\t}\n\treturn display.value ? (\n\t\t<div onClick={close} class='flex items-center justify-center bg-black/50 h-full fixed inset-0'>\n\t\t\t<div class='h-max w-full max-w-screen-sm p-4 flex flex-col gap-4 rounded-2xl bg-background' onClick={(e) => e.stopPropagation()}>\n\t\t\t\t<h2 className='text-xl font-semibold'>Import Transactions From JSON</h2>\n\t\t\t\t<div>\n\t\t\t\t\t<h3 className='font-semibold'>MEV Relay URL</h3>\n\t\t\t\t\t<textarea\n\t\t\t\t\t\tplaceholder={placeholder}\n\t\t\t\t\t\tonInput={(e: JSX.TargetedEvent<HTMLTextAreaElement>) => jsonInput.value = e.currentTarget.value}\n\t\t\t\t\t\tvalue={jsonInput.value} type=\"url\" className={`p-2 h-96 rounded-xl ${jsonInput.value !== '' && !isValid.value ? 'border-red-200' : 'border-slate-200/70'} border-2 bg-background w-full`} />\n\t\t\t\t</div>\n\t\t\t\t<div className='flex gap-2'>\n\t\t\t\t\t<Button onClick={importJson} disabled={!isValid.value} variant='primary'>Import</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t) : null\n}\n"]}