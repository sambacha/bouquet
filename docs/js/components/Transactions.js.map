{"version":3,"file":"Transactions.js","sourceRoot":"","sources":["../../ts/components/Transactions.tsx"],"names":[],"mappings":";AAAA,OAAO,EAA0B,WAAW,EAAE,SAAS,EAAE,eAAe,EAAE,MAAM,iBAAiB,CAAA;AACjG,OAAO,EAAE,KAAK,EAAE,MAAM,QAAQ,CAAA;AAE9B,OAAO,EAAE,wBAAwB,EAA8B,MAAM,2BAA2B,CAAA;AAEhG,OAAO,EAAE,gBAAgB,EAAE,MAAM,iBAAiB,CAAA;AAElD,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAA;AACpC,OAAO,EAAE,aAAa,EAAE,MAAM,0BAA0B,CAAA;AACxD,OAAO,EAAE,eAAe,EAAE,MAAM,0BAA0B,CAAA;AAE1D,SAAS,4BAA4B,CAAC,EAAgC;IACrE,IAAI,EAAE,CAAC,gBAAgB,CAAC,MAAM,CAAC,MAAM,KAAK,CAAC;QAAE,OAAO,4BAAG,GAAG,EAAE,CAAC,IAAI,IAAI,GAAI,CAAA;IACzE,MAAM,MAAM,GAAG,EAAE,CAAC,gBAAgB,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE,CAAC,YAAG,KAAK,EAAC,MAAM,YAAE,GAAG,CAAC,CAAC,IAAI,KAAK,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,QAAQ,EAAE,EAAE,GAAK,CAAC,CAAA;IAC5H,OAAO,CACN,8BACC,sBAAI,GAAG,EAAE,CAAC,IAAI,GAAG,GAAK,EACrB,MAAM,EACP,4BAAQ,IACN,CACH,CAAA;AACF,CAAC;AAED,MAAM,CAAC,MAAM,YAAY,GAAG,CAAC,EAC5B,QAAQ,EACR,MAAM,EACN,OAAO,EACP,SAAS,EACT,WAAW,EACX,gBAAgB,GAQhB,EAAE,EAAE;IACJ,MAAM,SAAS,GAAG,WAAW,CAAC,GAAG,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC,CAAC,KAAK,CAAC,CAAA;IAC1F,MAAM,UAAU,GAAG,SAAS,CAAyC,EAAE,CAAC,CAAA;IACxE,MAAM,YAAY,GAAG,SAAS,CAAqE,EAAE,CAAC,CAAA;IACtG,MAAM,QAAQ,GAAG,KAAK,IAAI,EAAE;QAC3B,IAAI,CAAC,QAAQ,CAAC,KAAK,IAAI,CAAC,MAAM,CAAC,KAAK;YAAE,OAAO,YAAY,CAAC,KAAK,GAAG,EAAE,CAAA;QACpE,MAAM,MAAM,GAAG,MAAM,wBAAwB,CAAC,MAAM,CAAC,KAAK,EAAE,OAAO,CAAC,KAAK,EAAE,SAAS,CAAC,KAAK,EAAE,WAAW,CAAC,KAAK,CAAC,cAAc,EAAE,gBAAgB,CAAC,KAAK,CAAC,CAAA;QACrJ,IAAI,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,MAAM,KAAK,CAAC,EAAE;YAC/C,OAAO,YAAY,CAAC,KAAK,GAAG,MAAM,CAAA;SAClC;aAAM;YACN,MAAM,MAAM,GAAG,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,EAAE;gBAC5C,IAAI,EAAE,CAAC,WAAW,CAAC,EAAE,IAAI,EAAE,CAAC,WAAW,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,CAAC,IAAI,KAAK,IAAI,IAAI,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,EAAE;oBAC/G,MAAM,OAAO,GAAG,4BAA4B,CAC3C,UAAU,CAAC,KAAK,CAAC,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,gBAAgB,CAAC,EAAE,GAAG,EAAE,CAAC,WAAW,EAAE,IAAI,EAAE,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,EAAE,EAAE,CAAC,CACjH,CAAA;oBACD,OAAO,EAAE,GAAG,EAAE,EAAE,OAAO,EAAE,CAAA;iBACzB;gBACD,OAAO,EAAE,CAAA;YACV,CAAC,CAAC,CAAA;YACF,OAAO,YAAY,CAAC,KAAK,GAAG,MAAM,CAAA;SAClC;IACF,CAAC,CAAA;IACD,eAAe,CAAC,GAAG,EAAE;QACpB,IAAI,QAAQ,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,EAAE;YACnC,QAAQ,EAAE,CAAA;SACV;IACF,CAAC,CAAC,CAAA;IAEF,MAAM,YAAY,GAAG,aAAa,EAAE,CAAA;IAEpC,KAAK,UAAU,iBAAiB;QAC/B,IAAI;YACH,MAAM,eAAe,GAAG,CAAC,GAAG,IAAI,GAAG,CAAC,YAAY,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,WAAW,CAAC,EAAE,KAAK,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,CAAa,CAAA;YACrJ,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,GAAG,CACjC,eAAe,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAC/B,KAAK,CACJ,cAAc,WAAW,CAAC,IAAI,EAAE,CAAC,aAAa,KAAK,gBAAgB,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,EAClF,2DAA2D,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,4CAA4C,CAC9I,CACD,CACD,CAAA;YACD,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,CAAA;YACzE,UAAU,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,IAAwC,EAAE,KAAK,EAAE,EAAE;gBACvF,IAAI,IAAI,CAAC,MAAM,KAAK,GAAG;oBAAE,OAAO,EAAE,GAAG,GAAG,EAAE,CAAC,GAAG,eAAe,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE,IAAI,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAA;;oBACtG,OAAO,GAAG,CAAA;YAChB,CAAC,EAAE,EAAE,CAAC,CAAA;YACN,QAAQ,EAAE,CAAA;SACV;QAAC,OAAO,KAAK,EAAE;YACf,OAAO,CAAC,GAAG,CAAC,4BAA4B,EAAE,KAAK,CAAC,CAAA;YAChD,UAAU,CAAC,KAAK,GAAG,EAAE,CAAA;SACrB;IACF,CAAC;IAED,SAAS,gBAAgB;QACxB,IAAI,CAAC,MAAM,CAAC,KAAK;YAAE,OAAM;QACzB,MAAM,UAAU,GAAG,eAAe,CAAC,aAAa,CAAC,MAAM,CAAC,KAAK,CAAC,YAAY,CAAC,CAAA;QAC3E,IAAI,SAAS,IAAI,UAAU,IAAI,UAAU,CAAC,OAAO;YAAE,SAAS,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAA;IAC5H,CAAC;IACD,OAAO,CACN,8BACC,aAAI,SAAS,EAAC,oBAAoB,kCAAuB,EACzD,eAAK,SAAS,EAAC,qBAAqB,aACnC,KAAC,MAAM,IAAC,OAAO,EAAC,WAAW,EAAC,QAAQ,EAAE,YAAY,CAAC,KAAK,CAAC,KAAK,CAAC,KAAK,KAAK,SAAS,EAAE,OAAO,EAAE,GAAG,EAAE,CAAC,YAAY,CAAC,OAAO,CAAC,iBAAiB,CAAC,mDAA6C,EACvL,KAAC,MAAM,IAAC,OAAO,EAAC,WAAW,EAAC,OAAO,EAAE,gBAAgB,YAAE,uDACtD,cACC,SAAS,EAAC,kBAAkB,iBAChB,MAAM,EAClB,IAAI,EAAC,MAAM,EACX,MAAM,EAAC,cAAc,kBACR,KAAK,EAClB,OAAO,EAAC,WAAW,EACnB,KAAK,EAAC,4BAA4B,YAElC,eACC,CAAC,EAAC,oOAAoO,oBACvN,OAAO,qBACN,OAAO,GAChB,GACH,IACJ,GACM,IACJ,EACN,cAAK,KAAK,EAAC,4BAA4B,YACrC,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,KAAK,EAAE,EAAE,CAAC,CACtC,eAAK,KAAK,EAAC,2DAA2D,aACrE,cAAK,KAAK,EAAC,sEAAsE,YAChF,gBAAM,KAAK,EAAC,mBAAmB,kBAAG,KAAK,IAAQ,GAC1C,EACN,eAAK,KAAK,EAAC,0FAA0F,aACpG,eAAK,KAAK,EAAC,yBAAyB,aACnC,eAAM,KAAK,EAAC,iBAAiB,qBAAY,EACzC,eAAM,KAAK,EAAC,uDAAuD,YACjE,SAAS,CAAC,KAAK,IAAI,EAAE,CAAC,WAAW,CAAC,IAAI,KAAK,YAAY,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,gBAAgB,CAAC,CAAC,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,GACtH,IACF,EACN,eAAK,KAAK,EAAC,yBAAyB,aACnC,eAAM,KAAK,EAAC,iBAAiB,mBAAU,EACvC,eAAM,KAAK,EAAC,uDAAuD,YAAE,EAAE,CAAC,WAAW,CAAC,EAAE,GAAQ,IACzF,EACN,eAAK,KAAK,EAAC,yBAAyB,aACnC,eAAM,KAAK,EAAC,iBAAiB,sBAAa,EAC1C,gBAAM,KAAK,EAAC,uDAAuD,aAAE,KAAK,CAAC,WAAW,CAAC,EAAE,CAAC,WAAW,CAAC,KAAK,IAAI,EAAE,CAAC,YAAY,IACzH,EACL,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,CACb,eAAK,KAAK,EAAC,yBAAyB,aACnC,eAAM,KAAK,EAAC,iBAAiB,qBAAY,EACzC,eAAM,KAAK,EAAC,wEAAwE,YAAE,EAAE,CAAC,OAAO,GAAQ,IACnG,CACN,CAAC,CAAC,CAAC,EAAE,CAAC,WAAW,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,CAAC,IAAI,KAAK,IAAI,CAAC,CAAC,CAAC,CACzD,eAAK,KAAK,EAAC,yBAAyB,aACnC,eAAM,KAAK,EAAC,iBAAiB,qBAAY,EACzC,eAAM,KAAK,EAAC,wEAAwE,YAAE,EAAE,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,EAAE,GAAQ,IACvH,CACN,CAAC,CAAC,CAAC,IAAI,IACH,IACD,CACN,CAAC,GACG,IACJ,CACH,CAAA;AACF,CAAC,CAAA","sourcesContent":["import { ReadonlySignal, Signal, useComputed, useSignal, useSignalEffect } from '@preact/signals'\nimport { utils } from 'ethers'\nimport { JSXInternal } from 'preact/src/jsx.js'\nimport { createBundleTransactions, FlashbotsBundleTransaction } from '../library/bundleUtils.js'\nimport { AppSettings, BlockInfo, Bundle, Signers } from '../types/types.js'\nimport { MEV_RELAY_GOERLI } from '../constants.js'\nimport { ProviderStore } from '../library/provider.js'\nimport { Button } from './Button.js'\nimport { useAsyncState } from '../library/asyncState.js'\nimport { TransactionList } from '../types/bouquetTypes.js'\n\nfunction formatTransactionDescription(tx: utils.TransactionDescription) {\n\tif (tx.functionFragment.inputs.length === 0) return <>{`${tx.name}()`}</>\n\tconst params = tx.functionFragment.inputs.map((y, index) => <p class='pl-4'>{`${y.name}: ${tx.args[index].toString()}`}</p>)\n\treturn (\n\t\t<>\n\t\t\t<p>{`${tx.name}(`}</p>\n\t\t\t{params}\n\t\t\t<p>)</p>\n\t\t</>\n\t)\n}\n\nexport const Transactions = ({\n\tprovider,\n\tbundle,\n\tsigners,\n\tblockInfo,\n\tappSettings,\n\tfundingAmountMin,\n}: {\n\tprovider: Signal<ProviderStore | undefined>\n\tbundle: Signal<Bundle | undefined>\n\tblockInfo: Signal<BlockInfo>\n\tsigners: Signal<Signers>\n\tappSettings: Signal<AppSettings>\n\tfundingAmountMin: ReadonlySignal<bigint>\n}) => {\n\tconst fundingTx = useComputed(() => bundle.value ? bundle.value.containsFundingTx : false)\n\tconst interfaces = useSignal<{ [address: string]: utils.Interface }>({})\n\tconst transactions = useSignal<(FlashbotsBundleTransaction & { decoded?: JSXInternal.Element })[]>([])\n\tconst updateTx = async () => {\n\t\tif (!provider.value || !bundle.value) return transactions.value = []\n\t\tconst result = await createBundleTransactions(bundle.value, signers.value, blockInfo.value, appSettings.value.blocksInFuture, fundingAmountMin.value)\n\t\tif (Object.keys(interfaces.value).length === 0) {\n\t\t\treturn transactions.value = result\n\t\t} else {\n\t\t\tconst parsed = transactions.value.map((tx) => {\n\t\t\t\tif (tx.transaction.to && tx.transaction.data && tx.transaction.data !== '0x' && tx.transaction.data.length > 0) {\n\t\t\t\t\tconst decoded = formatTransactionDescription(\n\t\t\t\t\t\tinterfaces.value[tx.transaction.to].parseTransaction({ ...tx.transaction, data: tx.transaction.data.toString() }),\n\t\t\t\t\t)\n\t\t\t\t\treturn { ...tx, decoded }\n\t\t\t\t}\n\t\t\t\treturn tx\n\t\t\t})\n\t\t\treturn transactions.value = parsed\n\t\t}\n\t}\n\tuseSignalEffect(() => {\n\t\tif (provider.value && bundle.value) {\n\t\t\tupdateTx()\n\t\t}\n\t})\n\n\tconst fetchingAbis = useAsyncState()\n\n\tasync function parseTransactions() {\n\t\ttry {\n\t\t\tconst uniqueAddresses = [...new Set(transactions.value.filter(tx => typeof tx.transaction.to === 'string').map((x) => x.transaction.to))] as string[]\n\t\t\tconst requests = await Promise.all(\n\t\t\t\tuniqueAddresses.map((address) =>\n\t\t\t\t\tfetch(\n\t\t\t\t\t\t`https://api${appSettings.peek().relayEndpoint === MEV_RELAY_GOERLI ? '-goerli' : ''\n\t\t\t\t\t\t}.etherscan.io/api?module=contract&action=getabi&address=${utils.getAddress(address.toLowerCase())}&apiKey=PSW8C433Q667DVEX5BCRMGNAH9FSGFZ7Q8`,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t)\n\t\t\tconst abis = await Promise.all(requests.map((request) => request.json()))\n\t\t\tinterfaces.value = abis.reduce((acc, curr: { status: string; result: string }, index) => {\n\t\t\t\tif (curr.status === '1') return { ...acc, [`${uniqueAddresses[index]}`]: new utils.Interface(curr.result) }\n\t\t\t\telse return acc\n\t\t\t}, {})\n\t\t\tupdateTx()\n\t\t} catch (error) {\n\t\t\tconsole.log('parseTransactionsCb Error:', error)\n\t\t\tinterfaces.value = {}\n\t\t}\n\t}\n\n\tfunction copyTransactions() {\n\t\tif (!bundle.value) return\n\t\tconst parsedList = TransactionList.safeSerialize(bundle.value.transactions)\n\t\tif ('success' in parsedList && parsedList.success) navigator.clipboard.writeText(JSON.stringify(parsedList.value, null, 2))\n\t}\n\treturn (\n\t\t<>\n\t\t\t<h2 className='font-bold text-2xl'>Your Transactions</h2>\n\t\t\t<div className='flex flex-row gap-4'>\n\t\t\t\t<Button variant='secondary' disabled={fetchingAbis.value.value.state === 'pending'} onClick={() => fetchingAbis.waitFor(parseTransactions)}>Decode Transactions From Etherscan</Button>\n\t\t\t\t<Button variant='secondary' onClick={copyTransactions}><>Copy Transaction List\n\t\t\t\t\t<svg\n\t\t\t\t\t\tclassName='h-8 inline-block'\n\t\t\t\t\t\taria-hidden='true'\n\t\t\t\t\t\tfill='none'\n\t\t\t\t\t\tstroke='currentColor'\n\t\t\t\t\t\tstroke-width='1.5'\n\t\t\t\t\t\tviewBox='0 0 24 24'\n\t\t\t\t\t\txmlns='http://www.w3.org/2000/svg'\n\t\t\t\t\t>\n\t\t\t\t\t\t<path\n\t\t\t\t\t\t\td='M16.5 8.25V6a2.25 2.25 0 00-2.25-2.25H6A2.25 2.25 0 003.75 6v8.25A2.25 2.25 0 006 16.5h2.25m8.25-8.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-7.5A2.25 2.25 0 018.25 18v-1.5m8.25-8.25h-6a2.25 2.25 0 00-2.25 2.25v6'\n\t\t\t\t\t\t\tstroke-linecap='round'\n\t\t\t\t\t\t\tstroke-linejoin='round'\n\t\t\t\t\t\t></path>\n\t\t\t\t\t</svg>\n\t\t\t\t</>\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t\t<div class='flex w-full flex-col gap-2'>\n\t\t\t\t{transactions.value.map((tx, index) => (\n\t\t\t\t\t<div class='flex w-full min-h-[96px] border-2 border-white rounded-xl'>\n\t\t\t\t\t\t<div class='flex w-24 flex-col items-center justify-center text-white border-r-2'>\n\t\t\t\t\t\t\t<span class='text-lg font-bold'>#{index}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class='bg-card flex w-full justify-center flex-col gap-2 rounded-r-xl p-4 text-sm font-semibold'>\n\t\t\t\t\t\t\t<div class='flex gap-2 items-center'>\n\t\t\t\t\t\t\t\t<span class='w-10 text-right'>From</span>\n\t\t\t\t\t\t\t\t<span class='rounded bg-background px-2 py-1 font-mono font-medium'>\n\t\t\t\t\t\t\t\t\t{fundingTx.value && tx.transaction.from === transactions.peek()[0].transaction.from ? 'FUNDING WALLET' : tx.transaction.from}\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class='flex gap-2 items-center'>\n\t\t\t\t\t\t\t\t<span class='w-10 text-right'>To</span>\n\t\t\t\t\t\t\t\t<span class='rounded bg-background px-2 py-1 font-mono font-medium'>{tx.transaction.to}</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class='flex gap-2 items-center'>\n\t\t\t\t\t\t\t\t<span class='w-10 text-right'>Value</span>\n\t\t\t\t\t\t\t\t<span class='rounded bg-background px-2 py-1 font-mono font-medium'>{utils.formatEther(tx.transaction.value ?? 0n)} ETH</span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{tx.decoded ? (\n\t\t\t\t\t\t\t\t<div class='flex gap-2 items-center'>\n\t\t\t\t\t\t\t\t\t<span class='w-10 text-right'>Data</span>\n\t\t\t\t\t\t\t\t\t<span class='rounded bg-background px-2 py-1 font-mono font-medium w-full break-all'>{tx.decoded}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : tx.transaction.data && tx.transaction.data !== '0x' ? (\n\t\t\t\t\t\t\t\t<div class='flex gap-2 items-center'>\n\t\t\t\t\t\t\t\t\t<span class='w-10 text-right'>Data</span>\n\t\t\t\t\t\t\t\t\t<span class='rounded bg-background px-2 py-1 font-mono font-medium w-full break-all'>{tx.transaction.data.toString()}</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t) : null}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</>\n\t)\n}\n"]}