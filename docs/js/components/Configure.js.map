{"version":3,"file":"Configure.js","sourceRoot":"","sources":["../../ts/components/Configure.tsx"],"names":[],"mappings":"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","sourcesContent":["import { batch, ReadonlySignal, Signal, useSignal, useSignalEffect } from '@preact/signals'\nimport { Wallet, utils } from 'ethers'\nimport { JSX } from 'preact/jsx-runtime'\nimport { ProviderStore } from '../library/provider.js'\nimport { BlockInfo, Bundle, Signers } from '../types/types.js'\n\nexport const Configure = ({\n\tprovider,\n\tbundle,\n\tfundingAmountMin,\n\tsigners,\n\tblockInfo,\n}: {\n\tprovider: Signal<ProviderStore | undefined>\n\tbundle: Signal<Bundle | undefined>\n\tsigners: Signal<Signers>\n\tfundingAmountMin: ReadonlySignal<bigint>\n\tblockInfo: Signal<BlockInfo>\n}) => {\n\tconst signerKeys = useSignal<{\n\t\t[address: string]: { input: string; wallet: Wallet | null }\n\t}>({})\n\n\tuseSignalEffect(() => {\n\t\tif (!bundle.value) signerKeys.value = {}\n\t})\n\n\tif (bundle.peek() && Object.keys(signerKeys.peek()).length === 0) {\n\t\tsignerKeys.value =\n\t\t\tbundle.value && Object.keys(signerKeys.peek()).length === 0\n\t\t\t\t? bundle.value.uniqueSigners.reduce(\n\t\t\t\t\t(\n\t\t\t\t\t\tcurr: {\n\t\t\t\t\t\t\t[address: string]: { input: string; wallet: Wallet | null }\n\t\t\t\t\t\t},\n\t\t\t\t\t\taddress,\n\t\t\t\t\t) => {\n\t\t\t\t\t\tcurr[utils.getAddress(address)] = { input: '', wallet: null }\n\t\t\t\t\t\treturn curr\n\t\t\t\t\t},\n\t\t\t\t\t{},\n\t\t\t\t)\n\t\t\t\t: {}\n\t}\n\n\tblockInfo.subscribe(() => {\n\t\tif (provider.value && signers.value.burner) {\n\t\t\tprovider.value.provider.getBalance(signers.value.burner.address).then((balance) => (signers.value.burnerBalance = balance.toBigInt()))\n\t\t}\n\t})\n\n\tfunction tryUpdateSigners(address: string, privateKey: string) {\n\t\tbatch(() => {\n\t\t\ttry {\n\t\t\t\tconst wallet = new Wallet(privateKey)\n\n\t\t\t\tsignerKeys.value = {\n\t\t\t\t\t...signerKeys.peek(),\n\t\t\t\t\t[address]: {\n\t\t\t\t\t\twallet: wallet.address === utils.getAddress(address) ? wallet : null,\n\t\t\t\t\t\tinput: privateKey,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\tsignerKeys.value = {\n\t\t\t\t\t...signerKeys.peek(),\n\t\t\t\t\t[address]: { wallet: null, input: privateKey },\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (Object.values(signerKeys.value).filter(({ wallet }) => !wallet).length === 0) {\n\t\t\t\tsigners.value = {\n\t\t\t\t\t...signers.peek(),\n\t\t\t\t\tbundleSigners: Object.values(signerKeys.peek()).reduce((acc: { [account: string]: Wallet }, wallet) => {\n\t\t\t\t\t\tif (wallet.wallet) {\n\t\t\t\t\t\t\tacc[wallet.wallet.address] = wallet.wallet\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn acc\n\t\t\t\t\t}, {}),\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tfunction copyBurnerToClipboard() {\n\t\tif (!signers.value.burner) return\n\t\tnavigator.clipboard.writeText(signers.value.burner.address)\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<h2 className='font-bold text-2xl'>2. Configure</h2>\n\t\t\t{bundle.value ? (\n\t\t\t\t<>\n\t\t\t\t\t<div className='flex flex-col w-full gap-4'>\n\t\t\t\t\t\t<h3 className='text-2xl font-semibold'>Enter Private Keys For Signing Accounts</h3>\n\t\t\t\t\t\t{bundle.value.uniqueSigners.map((address) => (\n\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t<span className='font-semibold -mb-2'>{address}</span>\n\t\t\t\t\t\t\t\t<input\n\t\t\t\t\t\t\t\t\ttype='text'\n\t\t\t\t\t\t\t\t\tvalue={signerKeys.value[address].input}\n\t\t\t\t\t\t\t\t\tonInput={(e: JSX.TargetedEvent<HTMLInputElement>) => tryUpdateSigners(address, e.currentTarget.value)}\n\t\t\t\t\t\t\t\t\tclassName={`p-4 text-lg rounded-xl border-slate-200/70 border-2 ${signerKeys.value[address].wallet ? 'bg-success/10' : signerKeys.peek()[address].input ? 'bg-error/10' : 'bg-background' }`}\n\t\t\t\t\t\t\t\t\tplaceholder={`Private key for ${address}`}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t\t{bundle.value?.containsFundingTx && signers.value.burner ? (\n\t\t\t\t\t\t<div className='flex flex-col w-full gap-4'>\n\t\t\t\t\t\t\t<h3 className='text-2xl font-semibold'>Deposit To Funding Account</h3>\n\t\t\t\t\t\t\t<p>This is a temporary account, send only enough needed plus a tiny bit to account for rising gas price changes.</p>\n\t\t\t\t\t\t\t<span className='p-4 flex items-center gap-4 w-max rounded-xl text-lg bg-white text-background font-bold font-mono'>\n\t\t\t\t\t\t\t\t{signers.value.burner.address}\n\t\t\t\t\t\t\t\t<button onClick={copyBurnerToClipboard} className='active:text-background/70'>\n\t\t\t\t\t\t\t\t\t<svg\n\t\t\t\t\t\t\t\t\t\tclassName='h-8 inline-block'\n\t\t\t\t\t\t\t\t\t\taria-hidden='true'\n\t\t\t\t\t\t\t\t\t\tfill='none'\n\t\t\t\t\t\t\t\t\t\tstroke='currentColor'\n\t\t\t\t\t\t\t\t\t\tstroke-width='1.5'\n\t\t\t\t\t\t\t\t\t\tviewBox='0 0 24 24'\n\t\t\t\t\t\t\t\t\t\txmlns='http://www.w3.org/2000/svg'\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<path\n\t\t\t\t\t\t\t\t\t\t\td='M16.5 8.25V6a2.25 2.25 0 00-2.25-2.25H6A2.25 2.25 0 003.75 6v8.25A2.25 2.25 0 006 16.5h2.25m8.25-8.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-7.5A2.25 2.25 0 018.25 18v-1.5m8.25-8.25h-6a2.25 2.25 0 00-2.25 2.25v6'\n\t\t\t\t\t\t\t\t\t\t\tstroke-linecap='round'\n\t\t\t\t\t\t\t\t\t\t\tstroke-linejoin='round'\n\t\t\t\t\t\t\t\t\t\t></path>\n\t\t\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<p className='font-semibold'>\n\t\t\t\t\t\t\t\tWallet Balance: <span className='font-medium font-mono'>{utils.formatEther(signers.value.burnerBalance)}</span> ETH\n\t\t\t\t\t\t\t\t<br />\n\t\t\t\t\t\t\t\tMinimum Required Balance: <span className='font-medium font-mono'>{utils.formatEther(fundingAmountMin.value)}</span> ETH\n\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t''\n\t\t\t\t\t)}\n\t\t\t\t</>\n\t\t\t) : (\n\t\t\t\t<p>No transactions imported yet.</p>\n\t\t\t)}\n\t\t</>\n\t)\n}\n"]}