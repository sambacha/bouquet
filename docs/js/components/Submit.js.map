{"version":3,"file":"Submit.js","sourceRoot":"","sources":["../../ts/components/Submit.tsx"],"names":[],"mappings":"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","sourcesContent":["import { utils } from 'ethers'\nimport { batch, ReadonlySignal, Signal, useComputed, useSignal, useSignalEffect } from '@preact/signals'\nimport { getMaxBaseFeeInFutureBlock } from '../library/bundleUtils.js'\nimport { Button } from './Button.js'\nimport { AppSettings, BlockInfo, Bundle, Signers } from '../types/types.js'\nimport { ProviderStore } from '../library/provider.js'\nimport { SettingsModal } from './Settings.js'\nimport { useAsyncState, AsyncProperty } from '../library/asyncState.js'\nimport { simulateBundle, sendBundle, checkBundleInclusion, RelayResponseError, SimulationResponseSuccess } from '../library/flashbots.js'\n\ntype PendingBundle = {\n\tbundles: {\n\t\t[bundleHash: string]: {\n\t\t\ttargetBlock: bigint,\n\t\t\tgas: { priorityFee: bigint, baseFee: bigint }\n\t\t\ttransactions: { signedTransaction: string, hash: string, account: string, nonce: bigint }[]\n\t\t\tincluded: boolean\n\t\t}\n\t}\n\terror?: Error\n}\n\nconst SimulationResult = ({\n\tstate\n}: {\n\tstate: Signal<AsyncProperty<SimulationResponseSuccess>>\n}) => {\n\tif (state.value.state === 'pending') return <div>Simulating...</div>\n\tif (state.value.state === 'resolved') {\n\t\treturn state.value.value.firstRevert ?\n\t\t\t<div>\n\t\t\t\t<h3 class='font-semibold text-error mb-2'>A Transaction Reverted During Simulation</h3>\n\t\t\t\t<div class='flex w-full min-h-[96px] border-2 border-white rounded-xl'>\n\t\t\t\t\t<div class='flex w-24 flex-col items-center justify-center text-white border-r-2'>\n\t\t\t\t\t\t<span class='text-lg font-bold'>#{state.value.value.results.findIndex((x) => 'error' in x)}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class='bg-card flex w-full justify-center flex-col gap-2 rounded-r-xl p-4 text-sm font-semibold'>\n\t\t\t\t\t\t<div class='flex gap-2 items-center'>\n\t\t\t\t\t\t\t<span class='w-16 text-right'>From</span>\n\t\t\t\t\t\t\t<span class='rounded bg-background px-2 py-1 font-mono font-medium'>{state.value.value.firstRevert.fromAddress}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class='flex gap-2 items-center'>\n\t\t\t\t\t\t\t<span class='w-16 text-right'>To</span>\n\t\t\t\t\t\t\t<span class='rounded bg-background px-2 py-1 font-mono font-medium'>{state.value.value.firstRevert.toAddress}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class='flex gap-2 items-center'>\n\t\t\t\t\t\t\t<span class='w-16 text-right'>Gas Used</span>\n\t\t\t\t\t\t\t<span class='rounded bg-background px-2 py-1 font-mono font-medium'>{state.value.value.firstRevert.gasUsed} gas</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class='flex gap-2 items-center'>\n\t\t\t\t\t\t\t<span class='w-16 text-right'>Error</span>\n\t\t\t\t\t\t\t<span class='rounded bg-background px-2 py-1 font-mono font-medium'>\n\t\t\t\t\t\t\t\t{'error' in state.value.value.firstRevert ? String(state.value.value.firstRevert.error) : 'Unknown'}\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t: <div>\n\t\t\t\t<h3 class='font-semibold text-success'>Simulation Succeeded</h3>\n\t\t\t</div>\n\t}\n\tif (state.value.state === 'rejected') {\n\t\treturn (\n\t\t\t<div>\n\t\t\t\t<h3 class='font-semibold text-error mb-2'>Simulation Failed</h3>\n\t\t\t\t<p class='rounded bg-background font-mono font-medium w-full break-all'>{state.value.error.message}</p>\n\t\t\t</div>\n\t\t)\n\t}\n\treturn <></>\n}\n\nexport const Bundles = ({\n\toutstandingBundles,\n}: {\n\toutstandingBundles: Signal<PendingBundle>\n}) => {\n\tif (outstandingBundles.value.error) return (<div>\n\t\t<h3 class='font-semibold text-error mb-2'>Error Sending Bundle</h3>\n\t\t<p class='rounded bg-background font-mono font-medium w-full break-all'>{outstandingBundles.value.error.message}</p>\n\t</div>)\n\treturn (\n\t\t<div class='flex flex-col-reverse gap-4'>\n\t\t\t{Object.values(outstandingBundles.value.bundles).map((bundle) => (\n\t\t\t\tbundle.included ?\n\t\t\t\t\t<div class='flex items-center flex-col font-semibold gap-2'>\n\t\t\t\t\t\t<h2 class='font-bold text-lg text-success'>Bundle Included!</h2>\n\t\t\t\t\t</div>\n\t\t\t\t\t:\n\t\t\t\t\t<div class='flex items-center gap-2 text-white'>\n\t\t\t\t\t\t<svg class=\"animate-spin h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n\t\t\t\t\t\t\t<circle class=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" stroke-width=\"4\"></circle>\n\t\t\t\t\t\t\t<path class=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t<p>Attempting to get bundle included in block {bundle.targetBlock.toString(10)} with max fee of {Number(utils.formatUnits(bundle.gas.baseFee + bundle.gas.priorityFee, 'gwei')).toPrecision(3)} gwei per gas</p>\n\t\t\t\t\t</div>\n\t\t\t))}\n\t\t</div>\n\t)\n}\n\nexport const Submit = ({\n\tprovider,\n\tbundle,\n\tfundingAmountMin,\n\tsigners,\n\tappSettings,\n\tblockInfo,\n}: {\n\tprovider: Signal<ProviderStore | undefined>\n\tbundle: Signal<Bundle | undefined>\n\tsigners: Signal<Signers>\n\tfundingAmountMin: ReadonlySignal<bigint>\n\tappSettings: Signal<AppSettings>\n\tblockInfo: Signal<BlockInfo>\n}) => {\n\tconst showSettings = useSignal<boolean>(false)\n\n\tconst submissionStatus = useSignal<{ active: boolean, lastBlock: bigint }>({ active: false, lastBlock: 0n })\n\tconst { value: simulationPromise, waitFor: waitForSimulation } = useAsyncState<SimulationResponseSuccess>()\n\n\tuseSignalEffect(() => {\n\t\tif (blockInfo.value.blockNumber > submissionStatus.value.lastBlock) {\n\t\t\tbundleSubmission(blockInfo.value.blockNumber)\n\t\t}\n\t})\n\n\tconst missingRequirements = useComputed(() => {\n\t\tif (!bundle.value) return 'No transactions imported yet.'\n\t\tconst missingSigners = bundle.value.uniqueSigners.length !== Object.keys(signers.value.bundleSigners).length\n\t\tconst insufficientBalance = signers.value.burnerBalance < fundingAmountMin.value\n\t\tif (missingSigners && insufficientBalance) return 'Missing private keys for signing accounts and funding wallet has insufficent balance.'\n\t\tif (missingSigners) return 'Missing private keys for signing accounts.'\n\t\tif (insufficientBalance) return 'Funding wallet has insufficent balance.'\n\t\treturn false\n\t})\n\n\tasync function simulateCallback() {\n\t\tif (!provider.value) throw 'User not connected'\n\t\tif (!bundle.value) throw 'No imported bundle found'\n\t\tconst simulationResult = await simulateBundle(\n\t\t\tbundle.value,\n\t\t\tfundingAmountMin.peek(),\n\t\t\tprovider.value,\n\t\t\tsigners.peek(),\n\t\t\tblockInfo.peek(),\n\t\t\tappSettings.peek()\n\t\t)\n\t\tif ('error' in simulationResult) throw new Error((simulationResult as RelayResponseError).error.message)\n\t\telse return simulationResult\n\t}\n\n\tconst outstandingBundles = useSignal<PendingBundle>({ bundles: {} })\n\n\tasync function bundleSubmission(blockNumber: bigint) {\n\t\tsubmissionStatus.value = { ...submissionStatus.peek(), lastBlock: blockNumber }\n\n\t\tif (!provider.value) throw new Error('User not connected')\n\t\tif (!bundle.value) throw new Error('No imported bundle found')\n\t\tconst providerStore = provider.value\n\n\t\t// Check status of current bundles\n\t\tconst checkedPending = await Promise.all(Object.keys(outstandingBundles.peek().bundles).map(bundleHash => checkBundleInclusion(outstandingBundles.peek().bundles[bundleHash].transactions, providerStore)))\n\t\tconst included = checkedPending.filter(checkedPending => checkedPending.included)\n\t\tif (included.length > 0) {\n\t\t\t// We done!\n\t\t\tbatch(() => {\n\t\t\t\toutstandingBundles.value = {\n\t\t\t\t\terror: outstandingBundles.peek().error,\n\t\t\t\t\tbundles: Object.keys(outstandingBundles.peek().bundles).reduce((checked: {\n\t\t\t\t\t\t[bundleHash: string]: {\n\t\t\t\t\t\t\ttargetBlock: bigint,\n\t\t\t\t\t\t\tgas: { priorityFee: bigint, baseFee: bigint }\n\t\t\t\t\t\t\ttransactions: { signedTransaction: string, hash: string, account: string, nonce: bigint }[]\n\t\t\t\t\t\t\tincluded: boolean\n\t\t\t\t\t\t}\n\t\t\t\t\t}, current, index) => {\n\t\t\t\t\t\tif (checkedPending[index].included) {\n\t\t\t\t\t\t\tchecked[current] = outstandingBundles.peek().bundles[current]\n\t\t\t\t\t\t\tchecked[current].included = checkedPending[index].included\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn checked\n\t\t\t\t\t}, {})\n\t\t\t\t}\n\t\t\t\tsubmissionStatus.value = { active: false, lastBlock: blockNumber }\n\t\t\t})\n\t\t} else {\n\t\t\t// Remove old submissions\n\t\t\toutstandingBundles.value = {\n\t\t\t\terror: outstandingBundles.peek().error,\n\t\t\t\tbundles: Object.keys(outstandingBundles.peek().bundles)\n\t\t\t\t\t.filter(tx => outstandingBundles.peek().bundles[tx].targetBlock > blockNumber)\n\t\t\t\t\t.reduce((obj: {\n\t\t\t\t\t\t[bundleHash: string]: {\n\t\t\t\t\t\t\ttargetBlock: bigint,\n\t\t\t\t\t\t\tgas: { priorityFee: bigint, baseFee: bigint }\n\t\t\t\t\t\t\ttransactions: { signedTransaction: string, hash: string, account: string, nonce: bigint }[]\n\t\t\t\t\t\t\tincluded: boolean\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}, bundleHash) => {\n\t\t\t\t\t\tobj[bundleHash] = outstandingBundles.peek().bundles[bundleHash]\n\t\t\t\t\t\treturn obj\n\t\t\t\t\t}, {})\n\t\t\t}\n\n\t\t\t// Try Submit\n\t\t\tif (submissionStatus.value.active) {\n\t\t\t\ttry {\n\t\t\t\t\tconst targetBlock = blockNumber + appSettings.peek().blocksInFuture\n\t\t\t\t\tconst gas = blockInfo.peek()\n\n\t\t\t\t\tconst bundleRequest = await sendBundle(\n\t\t\t\t\t\tbundle.value,\n\t\t\t\t\t\ttargetBlock,\n\t\t\t\t\t\tfundingAmountMin.peek(),\n\t\t\t\t\t\tprovider.value,\n\t\t\t\t\t\tsigners.peek(),\n\t\t\t\t\t\tblockInfo.peek(),\n\t\t\t\t\t\tappSettings.peek()\n\t\t\t\t\t)\n\n\t\t\t\t\tif (!(bundleRequest.bundleHash in outstandingBundles.peek())) {\n\t\t\t\t\t\toutstandingBundles.value = { ...outstandingBundles.peek(), [bundleRequest.bundleHash]: { targetBlock, gas, transactions: bundleRequest.bundleTransactions, included: false } }\n\t\t\t\t\t}\n\t\t\t\t} catch (err) {\n\t\t\t\t\tconsole.error(\"SendBundle error\", err)\n\t\t\t\t\tconst error = err && typeof err === 'object' && 'name' in err && 'message' in err && typeof err.name === 'string' && typeof err.message === 'string' ? new Error(err.message) : new Error(\"Unknown Error\")\n\t\t\t\t\tbatch(() => {\n\t\t\t\t\t\tsubmissionStatus.value = { active: false, lastBlock: blockNumber }\n\t\t\t\t\t\toutstandingBundles.value = { ...outstandingBundles.peek(), error }\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tasync function toggleSubmission() {\n\t\tbatch(() => {\n\t\t\tsubmissionStatus.value = { ...submissionStatus.peek(), active: !submissionStatus.peek().active }\n\t\t\toutstandingBundles.value = { ...outstandingBundles.peek(), error: undefined }\n\t\t})\n\t\tbundleSubmission(blockInfo.peek().blockNumber)\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<h2 className='font-bold text-2xl'>3. Submit</h2>\n\t\t\t<SettingsModal display={showSettings} appSettings={appSettings} />\n\t\t\t{missingRequirements.value ? (\n\t\t\t\t<p>{missingRequirements.peek()}</p>\n\t\t\t) : (\n\t\t\t\t<div className='flex flex-col w-full gap-4'>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<p><span className='font-bold'>Gas:</span> {utils.formatUnits(getMaxBaseFeeInFutureBlock(blockInfo.value.baseFee, appSettings.value.blocksInFuture), 'gwei')} gwei + {utils.formatUnits(appSettings.value.priorityFee.toString(), 'gwei')} gwei priority</p>\n\t\t\t\t\t\t<p><span className='font-bold'>Network:</span> {appSettings.value.relayEndpoint}</p>\n\t\t\t\t\t\t<p>Transactions will be attempt to be included in the block {appSettings.value.blocksInFuture.toString()} blocks from now.</p>\n\t\t\t\t\t\t<p>You can edit these settings <button className='font-bold underline' onClick={() => showSettings.value = true}>here</button>.</p>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className='flex flex-row gap-6'>\n\t\t\t\t\t\t<Button onClick={() => waitForSimulation(simulateCallback)} disabled={simulationPromise.value.state === 'pending'} variant='secondary'>Simulate</Button>\n\t\t\t\t\t\t<Button onClick={toggleSubmission}>{submissionStatus.value.active ? 'Stop' : 'Submit'}</Button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<SimulationResult state={simulationPromise} />\n\t\t\t\t\t<Bundles outstandingBundles={outstandingBundles} />\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</>\n\t)\n}\n"]}